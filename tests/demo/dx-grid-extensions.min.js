"use strict";function _defineProperty(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}!function(){window.dxGridExtensions={isUndefinedOrNull:function(n){return angular.isUndefined(n)||null===n}},window.dxGridExtensions.groupCellTemplate=function(n,t){$("<div>").html(t.text).appendTo(n)},window.dxGridExtensions.isInt=function(n){return!isNaN(Number(n))&&Number(n)%1==0},window.dxGridExtensions.isFloat=function(n){return!isNaN(Number(n))&&Number(n)%1!=0},window.dxGridExtensions.resetSelectBoxValue=function(n){var t=$(n).dxSelectBox("instance");dxGridExtensions.isUndefinedOrNull(t)||t.option("value",null)},window.dxGridExtensions.initFormulas=function(n){n.AND=formulajs.AND,n.OR=formulajs.OR,n.NOT=formulajs.NOT,n.IF=formulajs.IF,n.ISNULL=formulajs.ISNULL,n.CEILING=formulajs.CEILING,n.EXP=formulajs.EXP,n.FLOOR=formulajs.FLOOR,n.MAX=formulajs.MAX,n.MIN=formulajs.MIN,n.POW=formulajs.POW,n.RAND=formulajs.RAND,n.RANDBETWEEN=formulajs.RANDBETWEEN,n.ROUND=formulajs.ROUND,n.SIGN=formulajs.SIGN,n.DECIMAL=formulajs.DECIMAL,n.INT=formulajs.INT,n.CONCATENATE=formulajs.CONCATENATE,n.CONTAINS=formulajs.CONTAINS,n.LEN=formulajs.LEN,n.LOWER=formulajs.LOWER,n.MID=formulajs.MID,n.TRIM=formulajs.TRIM,n.UPPER=formulajs.UPPER,n.TODAY=formulajs.TODAY,n.WEEKDAY=formulajs.WEEKDAY,n.MONTH=formulajs.MONTH,n.YEAR=formulajs.YEAR},Object.byString=function(n,t){for(var e=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),o=0,i=e.length;o<i;++o){var l=e[o];if(!(l in n))return;n=n[l]}return n}}(),angular.module("dxGridExtensionTemplates",[]);var dxGridExtension=angular.module("dxGridExtension",["dx","ngRoute","dxGridExtensionTemplates"]);dxGridExtension.controller("columnChooser",["$scope","$controller","$timeout","customColumnConfiguration",function(n,t,e,o){function i(n){return _.find(o.customColumnFormats,function(t){if(t.value.dataType==n.dataType){if(dxGridExtensions.isUndefinedOrNull(t.value.format))return!1;if(t.value.format.type==n.format.type&&t.value.format.precision==n.format.precision)return!0}return!1})}function l(){for(var t=n.gridInstance.columnCount(),e=[],o=0;o<t;o++)e.push(n.gridInstance.columnOption(o));return e}function a(t){t.find(".dragRow").draggable({helper:"clone",scroll:!0,axis:"y",drag:function(t,o){e(function(){var t=n.columnChooserGrid.height()+n.columnChooserGrid.offset().top-50,e=n.columnChooserGrid.offset().top+50;if(o.offset.top<e){l=(i=n.columnChooserGrid.dxDataGrid("instance").getScrollable()).scrollOffset().top-10<0?0:i.scrollOffset().top-10;console.log(l),i.scrollTo(l)}if(o.offset.top>t){var i=n.columnChooserGrid.dxDataGrid("instance").getScrollable(),l=i.scrollOffset().top+10;console.log(l),i.scrollTo(l)}})},start:function(n,t){for(var e=$(this),o=t.helper,i=e.children(),l=o.children(),a=0;a<i.length;a++)$(l.get(a)).width($(i.get(a)).width());o.width(e.width()),o.addClass("drag-helper")}}),t.find(".dragRow").droppable({drop:function(e,o){var i=o.draggable.data("keyValue"),l=$(this).data("keyValue");if(!dxGridExtensions.isUndefinedOrNull(l)){var a=null,r=null;n.columnChooserDataSource.byKey(i).done(function(n){a=n.position}),n.columnChooserDataSource.byKey(l).done(function(n){r=n.position});var s=r<a?1:-1,d=null;n.columnChooserDataSource.load().done(function(n){d=n});for(var u=0;u<d.length;u++)d[u].position>Math.min(r,a)&&d[u].position<Math.max(r,a)&&(d[u].position+=s);n.columnChooserDataSource.update(i,{position:r}),n.columnChooserDataSource.update(l,{position:r+s}),t.dxDataGrid("instance").refresh()}}})}function r(t,e){t.dataType=e.value.dataType,t.format={type:null,precision:null},dxGridExtensions.isUndefinedOrNull(e.value.format)||(t.format.type=e.value.format.type,t.format.precision=e.value.format.precision);var o=_.find(n.config.groupItems,function(n){return n.column===t.dataField});dxGridExtensions.isUndefinedOrNull(o)||(dxGridExtensions.isUndefinedOrNull(e.value.format)?(o.valueFormat.type=null,o.valueFormat.precision=null):(o.valueFormat.type=e.value.format.type,o.valueFormat.precision=e.value.format.precision))}function s(t){_.remove(n.config.groupItems,function(n){return n.column===t})}function d(t){if(null!=n.currentColumn&&"string"!=n.currentColumn.dataType){var e=_.find(n.config.groupItems,function(n){return n.column===t});if(dxGridExtensions.isUndefinedOrNull(e)){var o=createDefaultNumberGroupItem(t);n.config.groupItems.push(o)}}}function u(t,e){var o=i(t);return{Id:e,dataField:t.dataField,caption:t.caption+"",visible:t.visible,hasAggregation:!dxGridExtensions.isUndefinedOrNull(_.find(n.config.groupItems,function(n){return n.column==t.dataField})),position:t.visibleIndex,format:o.text}}n.columnChooserGrid,n.gridManagement.showColumnChooserConsole=!1,n.getAllColumns=l,n.getColumnFormat=i,n.$watch(function(){return n.gridManagement.showColumnChooserConsole},function(){n.gridManagement.showColumnChooserConsole&&e(function(){n.columnChooserDataSource.clear();var t=l(),e=0;_.forEach(t,function(t){n.columnChooserDataSource.insert(u(t,e++))}),n.columnChooserGrid.dxDataGrid("instance").refresh()},500)}),n.columnChooserPopupOptions={width:800,contentTemplate:"info",height:"100%",dragEnabled:!0,showTitle:!0,closeOnOutsideClick:!1,title:"Management - Columns",bindingOptions:{visible:"gridManagement.showColumnChooserConsole"}},n.columnChooserDataSource=new DevExpress.data.ArrayStore({data:[]}),n.columnChooserGridOptions={dataSource:{store:n.columnChooserDataSource,sort:"position"},height:"90%",width:"100%",resize:!1,onContentReady:function(n){a(n.element)},onInitialized:function(t){n.columnChooserGrid=t.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},filterRow:{visible:!0},sorting:{mode:"none"},hoverStateEnabled:!0,controlColumnResizing:!1,showRowLines:!0,showColumnLines:!0,selection:{mode:"single"},onRowValidating:function(n){n.valid=!0},onRowPrepared:function(n){"data"==n.rowType&&(n.rowElement.addClass("dragRow"),n.rowElement.data("keyValue",n.key))},editing:{mode:"popup",allowUpdating:!0,popup:{showTitle:!1,width:700,height:345,position:{my:"middle",at:"middle",of:window}}},columns:[{dataField:"caption",caption:"Caption"},{dataField:"hasAggregation",caption:"Aggregation",dataType:"boolean",allowFiltering:!1},{dataField:"visible",caption:"Visible",dataType:"boolean",allowFiltering:!0},{dataField:"format",caption:"Format",lookup:{allowClearing:!1,dataSource:o.customColumnFormats,displayExpr:"text",valueExpr:"text"},allowFiltering:!1},{dataField:"position",caption:"Position",visible:!1,allowFiltering:!1}]},n.columnChooserValidateButtonOptions={text:"Validate changes",onClick:function(){n.columnChooserGrid.dxDataGrid("instance").saveEditData().then(function(t){n.updateGrid(function(){_.forEach(n.columnChooserDataSource._array,function(t){var e=_.find(n.config.columns,function(n){return t.dataField===n.dataField});e.visibleIndex=t.position,e.caption=t.caption,e.visible=t.visible,t.hasAggregation?d(t.dataField):s(t.dataField),r(e,_.find(o.customColumnFormats,function(n){return n.text==t.format}))}),e(function(){n.gridInstance.option("columns",n.config.columns),n.gridInstance.option("summary.groupItems",n.config.groupItems)},500)}),n.gridManagement.showColumnChooserConsole=!1})}}}]),dxGridExtension.controller("conditionalFormatting",["$scope","$controller","$timeout","conditionalFormattingConfiguration",function(n,t,e,o){function i(){try{n.conditionalFormattingResult=[];var t=n.conditionalFormatingExpressionText;n.conditionalFormattingExpressionTargetedColumns=""===n.expression?[]:t.match(/\[(.*?)\]/g),_.each(n.dataSource,function(t){var e={};_.each(n.conditionalFormattingExpressionTargetedColumns,function(n){var o=n.substring(1,n.length-1);if(!t.hasOwnProperty(o))throw new Error("Column "+o+" does not exist");e[o]=t[o]}),e[n.conditionalFormatingTargetColumn]=t[n.conditionalFormatingTargetColumn],n.conditionalFormattingResult.push(e)})}catch(t){return void n.conditionalFormattingResult.push({error:t.message})}}function l(){i();var t=n.conditionalFormatingGrid.dxDataGrid("instance");if(!dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)){var e=o.createRule(n.selectedConditionalFormattingRule.text,n.conditionalFormatingTargetColumn,n.conditionalFormatingExpressionText,n.currentConditionalFormattingColor,n.selectedConditionalFormattingIcon);t.option("onCellPrepared",function(t){o.applyConditionalFormattingExpressionOnCell(t,e,n.dataSource)}),t.repaint()}}function a(){null==n.conditionalFormatingTargetColumn||dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)?n.isCreateRuleDisabled=!0:n.selectedConditionalFormattingRule.isExpressionBased&&""===n.conditionalFormatingExpressionText?n.isCreateRuleDisabled=!0:n.isCreateRuleDisabled=!1}var r,s=o.availableIcons[0];n.gridManagement.showConditionalFormattingConsole=!1,n.conditionalFormatingGrid=null,n.conditionalFormattingResult=[],n.conditionalFormatingExpressionText="",n.isExpressionDisabled=!0,n.isCreateRuleDisabled=!0,n.conditionalFormattingExpressionTargetedColumns=[],n.selectedExistingConditionalFormattingRule=null,n.conditionalFormatingTargetColumn=null,n.selectedConditionalFormattingRule=null,n.selectedConditionalFormattingRules=[],n.currentConditionalFormattingColor="#ff2600",n.selectedConditionalFormattingIcon=s,n.config.conditionalFormattingRules=dxGridExtensions.isUndefinedOrNull(n.config.conditionalFormattingRules)?[]:_.transform(n.config.conditionalFormattingRules,function(n,t){n.push(o.getRuleFromdescriptor(t))},[]),n.$watch("selectedConditionalFormattingIcon",function(){dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||(n.selectedConditionalFormattingRule.icon=n.selectedConditionalFormattingIcon,l())}),n.$watch("currentConditionalFormattingColor",function(){if(!(dxGridExtensions.isUndefinedOrNull(n.currentConditionalFormattingColor)||dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingGrid)||dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule))){var t=n.conditionalFormatingGrid.dxDataGrid("instance");dxGridExtensions.isUndefinedOrNull(t)||(n.selectedConditionalFormattingRule.color=n.currentConditionalFormattingColor,l())}}),n.$watch("selectedConditionalFormattingRule",function(){a(),dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||(n.isExpressionDisabled=!n.selectedConditionalFormattingRule.isExpressionBased,l())}),n.$watch("conditionalFormatingExpressionText",function(){a(),dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||""===n.conditionalFormatingExpressionText&&(n.conditionalFormattingResult=[])}),n.$watch("gridManagement.showConditionalFormattingConsole",function(){dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingGrid)||n.conditionalFormatingGrid.dxDataGrid("instance").option("dataSource",null),n.conditionalFormatingExpressionText="",n.selectedConditionalFormattingIcon=s,n.currentConditionalFormattingColor="#ff2600",n.conditionalFormatingTargetColumn=null,dxGridExtensions.resetSelectBoxValue("#conditionFormatingTargetColumn")}),n.$watch("conditionalFormatingTargetColumn",function(){a(),dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingTargetColumn)||l()}),n.$watch("selectedConditionalFormattingRules",function(){0!=n.selectedConditionalFormattingRules.length&&(n.selectedConditionalFormattingRule=n.selectedConditionalFormattingRules[0].items[0])}),n.$watch("selectedExistingConditionalFormattingRule",function(){n.isExistingRuleActionDisabled=dxGridExtensions.isUndefinedOrNull(n.selectedExistingConditionalFormattingRule)}),n.consitionalFormattingAvailableColumnsSelectBoxOptions={bindingOptions:{items:"availableColumns",value:"selectedAvailableColumn",disabled:"isExpressionDisabled"},onItemClick:function(t){n.conditionalFormatingExpressionText+="["+t.itemData+"]",n.selectedAvailableColumn=null},placeholder:"Add column to expression"},n.conditionalFormattingTestExpressionButtonOptions={icon:"fa fa-hacker-news",text:"Test expression",bindingOptions:{disabled:"isCreateRuleDisabled"},onClick:l},n.conditionalFormattingPopupOptions=(r={width:750,contentTemplate:"info",showTitle:!1,height:"auto"},_defineProperty(r,"showTitle",!0),_defineProperty(r,"title","Management - Conditional Formatting"),_defineProperty(r,"dragEnabled",!0),_defineProperty(r,"closeOnOutsideClick",!0),_defineProperty(r,"bindingOptions",{visible:"gridManagement.showConditionalFormattingConsole"}),r),n.conditionalFormatingExpressionTextBoxOptions={bindingOptions:{value:"conditionalFormatingExpressionText",disabled:"isExpressionDisabled"},placeholder:"Enter expression...",showClearButton:!0},n.createConditionalFormattingButtonOptions={icon:"fa fa-hacker-news",text:"Create expression",bindingOptions:{disabled:"isCreateRuleDisabled"},onClick:function(t){if(!dxGridExtensions.isUndefinedOrNull(n.gridInstance)){var e=o.createRule(n.selectedConditionalFormattingRule.text,n.conditionalFormatingTargetColumn,n.conditionalFormatingExpressionText,n.currentConditionalFormattingColor,n.selectedConditionalFormattingIcon);_.remove(n.config.conditionalFormattingRules,{target:e.target}),n.config.conditionalFormattingRules.push(e),n.gridInstance.repaint(),n.gridManagement.showConditionalFormattingConsole=!1}}},n.conditionalFormatingAvailableTargetColumnsOptions={bindingOptions:{value:"conditionalFormatingTargetColumn",items:"availableColumns"},placeholder:"Choose target column..."},n.conditionalFormattingResultGridPopupOptions={bindingOptions:{dataSource:"conditionalFormattingResult"},height:350,resize:!1,onInitialized:function(t){n.conditionalFormatingGrid=t.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},loadPanel:{enabled:!0},hoverStateEnabled:!0,controlColumnResizing:!0,showRowLines:!0,showColumnLines:!1,selection:{mode:"single"},sorting:{mode:"multiple"}},n.rulesListOptions={bindingOptions:{selectedItems:"selectedConditionalFormattingRules"},showSelectionControls:!0,selectionMode:"single",selectAllMode:"allPages",items:o.availableRules,height:"50%",grouped:!0,collapsibleGroups:!0,groupTemplate:function(n){return $("<div>Type: "+n.key+"</div>")}},n.conditionalFormattingColorBox={bindingOptions:{value:"currentConditionalFormattingColor"},applyValueMode:"instantly"},n.availableIconsSelectBoxOptions={dataSource:o.availableIcons,displayExpr:"name",valueExpr:"css",bindingOptions:{value:"selectedConditionalFormattingIcon"},placeholder:"Select an icon..."},n.deleteExistingRuleButtonOptions={text:"Delete",bindingOptions:{disabled:"isExistingRuleActionDisabled"},onClick:function(){_.remove(n.config.conditionalFormattingRules,{target:n.selectedExistingConditionalFormattingRule.target}),n.gridInstance.repaint(),n.gridManagement.showConditionalFormattingConsole=!1}},n.loadExistingRuleButtonOptions={text:"Load",bindingOptions:{disabled:"isExistingRuleActionDisabled"},onClick:function(){n.conditionalFormatingTargetColumn=n.selectedExistingConditionalFormattingRule.target,n.conditionalFormatingExpressionText=n.selectedExistingConditionalFormattingRule.expression,n.currentConditionalFormattingColor=n.selectedExistingConditionalFormattingRule.color,n.selectedConditionalFormattingIcon=n.selectedExistingConditionalFormattingRule.icon,$("#conditionalFormattingRuleList").dxList("instance").selectItem(_.find(o.getAllRules(),function(t){return t.text==n.selectedExistingConditionalFormattingRule.text}))}},n.existingConditionalFormattingRulesSelectBoxOptions={displayExpr:"target",bindingOptions:{dataSource:"config.conditionalFormattingRules",value:"selectedExistingConditionalFormattingRule"},placeholder:"Load existing rule..."}}]),dxGridExtension.controller("customColumns",["$scope","$controller","$timeout","$log","customColumnConfiguration",function(n,t,e,o,i){function l(t){_.remove(n.config.customColumns,{name:t}),_.each(n.dataSource,function(n){delete n[t]}),_.remove(n.config.columns,{dataField:t}),_.remove(n.config.groupItems,{column:t}),n.gridInstance.repaint()}function a(){n.cannotCreateColumn=""==n.selectedCustomColumnFormating||""==n.customColumnExpressionText||dxGridExtensions.isUndefinedOrNull(n.customColumnName)||dxGridExtensions.isUndefinedOrNull(n.selectedCustomColumnFormating)}function r(){try{if(_.some(n.config.columns,function(t){return t.caption===n.customColumnName}))throw new Error("Column "+n.customColumnName+" already exist");if(_.some(n.config.customColumns,function(t){return t.caption===n.customColumnName}))throw new Error("Column "+n.customColumnName+" already exist");var t=n.customColumnExpressionText,o=t.match(/\[(.*?)\]/g);n.customColumnResult=[],_.each(n.dataSource,function(t){var e={};_.each(o,function(n){var o=n.substring(1,n.length-1);if(!t.hasOwnProperty(o))throw new Error("Column "+o+" does not exist");e[o]=t[o]}),e[n.customColumnName]=t[n.customColumnName],n.customColumnResult.push(e)});var l=n.customColumnGrid.dxDataGrid("instance");i.computeCustomColumn({name:n.customColumnName,expression:t},n.customColumnResult),e(function(){l.columnOption(n.customColumnName,"dataType",n.selectedCustomColumnFormating.dataType),null!=n.selectedCustomColumnFormating.format&&l.columnOption(n.customColumnName,"format",{type:n.selectedCustomColumnFormating.format.type,precision:n.selectedCustomColumnFormating.format.precision})},500)}catch(t){return void n.customColumnResult.push({error:t.message})}}n.gridManagement.showCustomColumnConsole=!1,n.customColumnGrid=null,n.customColumnExpressionText="",n.customColumnName=null,n.customColumnResult=[],n.customColumnSelectedAvailableColumn=null,n.selectedCustomColumnFormating=null,n.cannotCreateColumn=!0,n.isExistingRuleActionDisabled=!0,n.selectedExistingCustomColumn=null,n.isExistingCustomColumnActionDisabled=!1,dxGridExtensions.isUndefinedOrNull(n.config.customColumns)&&(n.config.customColumns=[]),n.$watch(function(){return n.gridManagement.showCustomColumnConsole},function(){n.gridManagement.showCustomColumnConsole&&(dxGridExtensions.isUndefinedOrNull(n.customColumnGrid)||n.customColumnGrid.dxDataGrid("instance").option("dataSource",null),n.customColumnExpressionText="",n.customColumnName="",n.customColumnSelectedAvailableColumn=null,dxGridExtensions.resetSelectBoxValue("#customColumnAvailableColumnsFormat"),dxGridExtensions.resetSelectBoxValue("#existingCustomColumns"),n.selectedExistingCustomColumn="",n.selectedCustomColumnFormating="")}),n.$watch("customColumnExpressionText",function(){a()}),n.$watch("customColumnName",function(){a()}),n.$watch("selectedCustomColumnFormating",function(){a()}),n.$watch("selectedExistingCustomColumn",function(){n.isExistingCustomColumnActionDisabled=dxGridExtensions.isUndefinedOrNull(n.selectedExistingCustomColumn)||""==n.selectedExistingCustomColumn}),n.customColumnResultGridOptions={bindingOptions:{dataSource:"customColumnResult"},height:200,resize:!1,onInitialized:function(t){n.customColumnGrid=t.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},loadPanel:{enabled:!0},hoverStateEnabled:!0,controlColumnResizing:!0,showRowLines:!0,showColumnLines:!1,selection:{mode:"single"},sorting:{mode:"multiple"}},n.customColumnAvailableColumnsSelectBoxOptions={bindingOptions:{items:"availableColumns",value:"customColumnSelectedAvailableColumn"},onItemClick:function(t){n.customColumnExpressionText+="["+t.itemData+"]",n.customColumnSelectedAvailableColumn=null,dxGridExtensions.resetSelectBoxValue("#customColumnAvailableColumns")},placeholder:"Add column to expression"},n.customColumnAvailableFormattingSelectBoxOptions={displayExpr:"text",valueExpr:"value",items:i.customColumnFormats,bindingOptions:{value:"selectedCustomColumnFormating"},placeholder:"Choose column format"},n.customColumnPopupOptions={width:900,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,title:"Management - Custom Columns",closeOnOutsideClick:!0,bindingOptions:{visible:"gridManagement.showCustomColumnConsole"}},n.customColumnNameTextBoxOptions={bindingOptions:{value:"customColumnName"},placeholder:"Enter column name...",showClearButton:!0},n.customColumnExpressionTextBoxOptions={bindingOptions:{value:"customColumnExpressionText"},placeholder:"Enter expression...",showClearButton:!0},n.customColumnTestExpressionButtonOptions={icon:"fa fa-hacker-news",text:"Test expression",bindingOptions:{disabled:"cannotCreateColumn"},onClick:r},n.createRuleButtonOptions={icon:"fa fa-hacker-news",text:"Create column",bindingOptions:{disabled:"cannotCreateColumn"},onClick:function(t){if(!dxGridExtensions.isUndefinedOrNull(n.gridInstance)){n.updateGrid(function(){var t=i.createCustomColumn(n.customColumnName,n.customColumnExpressionText,n.selectedCustomColumnFormating);_.remove(n.config.customColumns,{name:t.name}).length>0&&l(t.name),n.config.customColumns.push(t),i.computeCustomColumn(t,n.dataSource);var e={dataField:n.customColumnName,caption:n.customColumnName,dataType:n.selectedCustomColumnFormating.dataType,format:{type:n.selectedCustomColumnFormating.format.type,precision:n.selectedCustomColumnFormating.format.precision},visibleIndex:n.currentColumn.visibleIndex};n.config.columns.push(e),"number"===n.selectedCustomColumnFormating.dataType&&n.config.groupItems&&n.config.groupItems.push({column:e.dataField,summaryType:"sum",showInGroupFooter:!1,alignByColumn:!0,valueFormat:{type:n.selectedCustomColumnFormating.format.type,precision:n.selectedCustomColumnFormating.format.precision},displayFormat:"{0}"})});var e=n.gridInstance.state?n.gridInstance.state():void 0;e&&n.gridInstance.state(e),n.gridManagement.showCustomColumnConsole=!1}}},n.deleteExistingCustomColumnButtonOptions={text:"Delete",bindingOptions:{disabled:"isExistingCustomColumnActionDisabled"},onClick:function(){l(n.selectedExistingCustomColumn.name),n.gridManagement.showCustomColumnConsole=!1}},n.loadExistingCustomColumnButtonOptions={text:"Load",bindingOptions:{disabled:"isExistingCustomColumnActionDisabled"},onClick:function(){n.customColumnName=n.selectedExistingCustomColumn.name,n.customColumnExpressionText=n.selectedExistingCustomColumn.expression,n.selectedCustomColumnFormating=n.selectedExistingCustomColumn.format}},n.existingCustomColumnsSelectBoxOptions={displayExpr:"name",bindingOptions:{dataSource:"config.customColumns",value:"selectedExistingCustomColumn"},placeholder:"Load existing column..."}}]),dxGridExtension.controller("columnManagement",["$scope","$controller","$timeout","customColumnConfiguration",function(n,t,e,o){n.gridManagement.showColumnManagementConsole=!1,n.columnManagementColumnName,n.columnManagementColumnFormating,n.cannotValidateChange,n.columnManagementPopupOptions={width:350,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,closeOnOutsideClick:!0,bindingOptions:{visible:"gridManagement.showColumnManagementConsole",title:"columnManagementColumnName"}},n.$watch(function(){return n.gridManagement.showColumnManagementConsole},function(){!dxGridExtensions.isUndefinedOrNull(n.currentColumn)&&n.gridManagement.showColumnManagementConsole&&(n.columnManagementColumnName=n.currentColumn.caption,n.columnManagementColumnFormating=_.find(o.customColumnFormats,function(t){if(t.value.dataType==n.currentColumn.dataType)if(dxGridExtensions.isUndefinedOrNull(n.currentColumn.format)){if(dxGridExtensions.isUndefinedOrNull(t.value.format))return!0}else{if(dxGridExtensions.isUndefinedOrNull(t.value.format))return!1;if(t.value.format.type==n.currentColumn.format.type&&t.value.format.precision==n.currentColumn.format.precision)return!0}return!1}))}),n.$watch("columnManagementColumnName",function(){n.cannotValidateChange=""==n.columnManagementColumnName}),n.columnManagementColumnNameTextBoxOptions={bindingOptions:{value:"columnManagementColumnName"},onInput:function(t){n.cannotValidateChange=""==t.component._options.text},showClearButton:!0},n.columnManagementAvailableFormattingSelectBoxOptions={displayExpr:"text",items:o.customColumnFormats,bindingOptions:{value:"columnManagementColumnFormating"}},n.columnManagementValidateButtonOptions={text:"Validate changes",bindingOptions:{disabled:"cannotValidateChange"},onClick:function(){n.updateGrid(function(){n.gridInstance.columnOption(n.currentColumn.dataField,"caption",n.columnManagementColumnName),n.gridInstance.columnOption(n.currentColumn.dataField,"dataType",n.columnManagementColumnFormating.value.dataType),n.gridInstance.columnOption(n.currentColumn.dataField,"format",{type:null,precision:null}),dxGridExtensions.isUndefinedOrNull(n.columnManagementColumnFormating.value.format)||(n.gridInstance.columnOption(n.currentColumn.dataField,"format.type",n.columnManagementColumnFormating.value.format.type),n.gridInstance.columnOption(n.currentColumn.dataField,"format.precision",n.columnManagementColumnFormating.value.format.precision));var t=_.find(n.groupItems,function(t){return t.column===n.currentColumn.dataField});dxGridExtensions.isUndefinedOrNull(t)||(dxGridExtensions.isUndefinedOrNull(n.columnManagementColumnFormating.value.format)?(t.valueFormat.type=null,t.valueFormat.precision=null):(t.valueFormat.type=n.columnManagementColumnFormating.value.format.type,t.valueFormat.precision=n.columnManagementColumnFormating.value.format.precision)),n.gridInstance.option(n.currentColumn.dataField,"summary.groupItems",n.config.groupItems)}),n.gridManagement.showColumnManagementConsole=!1}}}]),dxGridExtension.controller("baseGridManagement",["$scope","$controller","$attrs",function(n,t,e){function o(){dxGridExtensions.isUndefinedOrNull(n.config.columns)||(n.dataSource=n.self[e.datasource],n.availableColumns=_.sortBy(_.transform(n.config.columns.concat(null===n.config.customColumns?[]:n.config.customColumns),function(n,t){n.push(t.dataField)},[]),function(n){return n}))}n.self=n.$parent,n.gridName=e.instance,n.self.gridManagement||(n.self.gridManagement={}),n.self.config||(n.self.config={},n.self.config[e.instance]={}),n.gridManagement=n.self.gridManagement[e.instance],n.config=n.self.config[e.instance],n.updateGrid=function(t){n.gridInstance.beginUpdate(),t(),n.gridInstance.endUpdate()},n.$watch(function(){return n.self[e.datasource]},function(){n.dataSource=n.self[e.datasource],o(),n.availableColumns=_.sortBy(_.transform(n.config.columns,function(n,t){n.push(t.dataField)},[]),function(n){return n})}),n.$watch(function(){return n.config.customColumns},function(){o()}),n.$watch(function(){return n.config.customColumns.length},function(){o()}),n.$watch(function(){return n.self[e.instance]},function(){n.gridInstance=n.self[e.instance]}),n.$watch(function(){return n.self.gridManagement[e.instance].currentColumn},function(){n.currentColumn=n.self.gridManagement[e.instance].currentColumn}),n.$watch(function(){return n.self.gridManagement[e.instance].currentRow},function(){n.currentRow=n.self.gridManagement[e.instance].currentRow});var i={$scope:n};t("columnManagement",i),t("conditionalFormatting",i),t("columnChooser",i),t("customColumns",i)}]),dxGridExtension.directive("flatGridManagement",["$controller",function(n){return{restrict:"E",scope:!0,templateUrl:"view.flat.grid.management.html",controller:["$scope","$attrs",function(t,e){n("baseGridManagement",{$scope:t,$attrs:e})}]}}]),dxGridExtension.directive("flatGrid",["$timeout","$controller","customColumnConfiguration","conditionalFormattingConfiguration",function(n,t,e,o){return{restrict:"E",templateUrl:"view.grid.flat.html",scope:!0,link:function(t,i,l){function a(){return Object.byString(t,t.flatGridOptions.bindingOptions.dataSource.dataPath)}function r(){if(dxGridExtensions.isUndefinedOrNull(t.$control))return null;try{var n=t.self[t.flatGridName].NAME?t.self[t.flatGridName]:t.$control.find("#flatGrid").dxDataGrid("instance");return t.self[t.flatGridName]!==n&&(t.self[t.flatGridName]=n),n}catch(n){return null}}function s(n,e){dxGridExtensions.isUndefinedOrNull(t.self.config[t.flatGridName])&&(t.self.config[t.flatGridName]={}),t.self.config[t.flatGridName][n]=e}function d(n){return dxGridExtensions.isUndefinedOrNull(t.self.config[t.flatGridName])&&(t.self.config[t.flatGridName]={}),t.self.config[t.flatGridName][n]}function u(){n(function(){var n=r();dxGridExtensions.isUndefinedOrNull(n.option("onCellPrepared"))&&m("onCellPrepared",function(n){_.each(d("conditionalFormattingRules"),function(t){o.applyConditionalFormattingExpressionOnCell(n,t,a())})}),m("onContextMenuPreparing",function(n){n.row&&"data"===n.row.rowType&&(n.items=c(n))}),m("customizeColumns",function(n){_.each(n,function(n){n.groupCellTemplate=window.dxGridExtensions.groupCellTemplate})});var t=d("gridState");dxGridExtensions.isUndefinedOrNull(t)||(n=r()).state(t)})}function m(n,t){var e=r(),o=e.option(n);e.option(n,function(n){null!=o&&o(n),t(n)})}function c(n){return t.self.gridManagement[t.flatGridName].currentColumn=n.column,t.self.gridManagement[t.flatGridName].currentRow=n.row,[{text:"Management - Columns",onItemClick:function(){t.self.gridManagement[t.flatGridName].showColumnChooserConsole=!0}},{text:"Management - Conditional Formatting",onItemClick:function(){t.self.gridManagement[t.flatGridName].showConditionalFormattingConsole=!0}},{text:"Management - Custom Columns",onItemClick:function(){t.self.gridManagement[t.flatGridName].showCustomColumnConsole=!0}},{text:"Current Column - Modify",onItemClick:function(){t.self.gridManagement[t.flatGridName].showColumnManagementConsole=!0}},{text:"Current Column - Remove Aggregation",onItemClick:function(){_.remove(t.self.config[t.flatGridName].groupItems,function(n){return n.column===t.self.gridManagement[t.flatGridName].currentColumn.dataField})}},{text:"Current Column - Create Aggregation",onItemClick:function(){if(null!=t.self.gridManagement[t.flatGridName].currentColumn&&"string"!=t.self.gridManagement[t.flatGridName].currentColumn.dataType){var n=d("groupItems");if(!dxGridExtensions.isUndefinedOrNull(n)){var e=_.find(t.self.config.groupItems,function(n){return n.column===t.self.gridManagement[t.flatGridName].currentColumn.dataField});if(dxGridExtensions.isUndefinedOrNull(e)){var o=g(t.self.gridManagement[t.flatGridName].currentColumn.dataField);t.self.config[t.flatGridName].groupItems.push(o)}}}}}]}function g(n){return{column:n,summaryType:"sum",showInGroupFooter:!1,alignByColumn:!0,valueFormat:{type:"fixedpoint",precision:2},displayFormat:"{0}"}}t.self=t.$parent,t.self.config||(t.self.config={}),t.self.config[l.instance]={},t.flatGridName=l.instance,t.flatGridOptions=t.self[l.options],t.$control=i,t.self.gridManagement||(t.self.gridManagement={}),t.self.gridManagement[t.flatGridName]={},t.self.currentColumn=null,t.self.currentRow=null;var p=dxGridExtensions.isUndefinedOrNull(d("columns"))?null:d("columns"),f=dxGridExtensions.isUndefinedOrNull(d("groupItems"))?null:d("groupItems");s("columns",p),s("groupItems",f),n(function(){return u()}),t.$watch(t.flatGridOptions.bindingOptions.columns,function(){var n=d("columns"),t=d("groupItems");s("groupItems",_.transform(n,function(n,e){if("number"===e.dataType){var o=_.find(t,function(n){return e.column==e.dataField});if(dxGridExtensions.isUndefinedOrNull(o)){var i=g(e.dataField);n.push(i)}else n.push(i)}},[]))}),t.$watch(t.flatGridOptions.bindingOptions.dataSource,function(){var n=a();if(!dxGridExtensions.isUndefinedOrNull(n)&&0!=n.length){_.each(d("customColumns"),function(t){e.computeCustomColumn(t,n)});var t=n[0],o=0;s("columns",_.transform(Object.keys(t),function(t,e){var i={dataField:e,caption:e,dataType:"string",visibleIndex:o++,format:{type:"",precision:0}},l=_.find(d("columns"),function(n){return n.dataField==e});if(null!=l)t.push(l);else{for(var a=0;a<n.length;a++)if(!dxGridExtensions.isUndefinedOrNull(n[a][e])){if("boolean"==typeof n[a][e]){i.dataType="boolean";break}if(dxGridExtensions.isInt(n[a][e])){i.dataType="number",i.format={type:"fixedpoint",precision:0};break}if(dxGridExtensions.isFloat(n[a][e])){i.dataType="number",i.summaryType="sum",i.format={type:"fixedpoint",precision:2};break}i.dataType="string",i.format={type:"",precision:0};break}t.push(i)}},[]))}}),t.self.exportExcel=function(){var n=r();n.option("export",{enabled:!1,fileName:t.self.container._config.title+"_"+moment(t.self.workspace.date).format("YYYYMMDD")}),n.exportToExcel()}}}}]),dxGridExtension.directive("treeGridManagement",["$controller",function(n){return{restrict:"E",scope:{},templateUrl:"view.tree.grid.management.html",controller:["$scope","$attrs",function(t,e){n("baseGridManagement",{$scope:t,$attrs:e})}]}}]),dxGridExtension.directive("treeGrid",["$timeout","$controller","customColumnConfiguration","conditionalFormattingConfiguration",function(n,t,e,o){return{restrict:"E",templateUrl:"view.grid.tree.html",scope:!0,link:{pre:function(t,e,i){function l(){if(dxGridExtensions.isUndefinedOrNull(t.$control))return null;try{var n=t.self[t.treeListName].NAME?t.self[t.treeListName]:t.$control.find("#treeGrid").dxTreeList("instance");return t.self[t.treeListName]!==n&&(t.self[t.treeListName]=n),n}catch(n){return null}}function a(n,e){dxGridExtensions.isUndefinedOrNull(t.self.config[t.treeListName])&&(t.self.config[t.treeListName]={}),t.self.config[t.treeListName][n]=e}function r(n){return dxGridExtensions.isUndefinedOrNull(t.self.config[t.treeListName])&&(t.self.config[t.treeListName]={}),t.self.config[t.treeListName][n]}function s(){n(function(){var n=l();dxGridExtensions.isUndefinedOrNull(n.option("onCellPrepared"))&&d("onCellPrepared",function(n){_.each(r("conditionalFormattingRules"),function(e){var i=Object.byString(t,t.treeListOptions.bindingOptions.dataSource.dataPath);o.applyConditionalFormattingExpressionOnCell(n,e,i)})}),d("onContextMenuPreparing",function(n){n.row&&"data"===n.row.rowType&&(n.items=u(n))}),d("customizeColumns",function(n){_.each(n,function(n){n.groupCellTemplate=window.dxGridExtensions.groupCellTemplate})})})}function d(n,t){var e=l(),o=e.option(n);e.option(n,function(n){null!=o&&o(n),t(n)})}function u(n){return t.self.gridManagement[t.treeListName].currentColumn=n.column,t.self.gridManagement[t.treeListName].currentRow=n.row,[{text:"Management - Columns",onItemClick:function(){t.self.gridManagement[t.treeListName].showColumnChooserConsole=!0}},{text:"Management - Conditional Formatting",onItemClick:function(){t.self.gridManagement[t.treeListName].showConditionalFormattingConsole=!0}},{text:"Management - Custom Columns",onItemClick:function(){t.self.gridManagement[t.treeListName].showCustomColumnConsole=!0}},{text:"Current Column - Modify",onItemClick:function(){t.self.gridManagement[t.treeListName].showColumnManagementConsole=!0}}]}t.self=t.$parent,t.self.config||(t.self.config={}),t.self.config[i.instance]={},t.treeListName=i.instance,t.treeListOptions=t.self[i.options],t.$control=e,t.self.gridManagement||(t.self.gridManagement={}),t.self.gridManagement[t.treeListName]={},t.self.currentColumn=null,t.self.currentRow=null,a("columns",dxGridExtensions.isUndefinedOrNull(r("columns"))?null:r("columns")),n(function(){return s()}),t.$watch(t.treeListOptions.bindingOptions.dataSource,function(){var n=Object.byString(t,t.treeListOptions.bindingOptions.dataSource.dataPath);if(!dxGridExtensions.isUndefinedOrNull(n)&&0!=n.length){var e=n[0],o=0;a("columns",_.transform(Object.keys(e),function(t,e){var i={dataField:e,caption:e,dataType:"string",format:{type:"",precision:0},visibleIndex:o++},l=_.find(r("columns"),function(n){return n.dataField==e});if(null!=l)t.push(l);else{for(var a=0;a<n.length;a++)if(!dxGridExtensions.isUndefinedOrNull(n[a][e])){if("boolean"==typeof n[a][e]){i.dataType="boolean";break}if(window.dxGridExtensions.isInt(n[a][e])){i.dataType="number",i.format={type:"fixedpoint",precision:0};break}if(window.dxGridExtensions.isFloat(n[a][e])){i.dataType="number",i.summaryType="sum",i.format={type:"fixedpoint",precision:2};break}i.dataType="string",i.format={type:"",precision:0};break}t.push(i)}},[]))}})}}}}]),angular.module("dxGridExtensionTemplates").run(["$templateCache",function(n){n.put("view.flat.grid.management.html",'<div class="popup" id="conditionalFormattingConsole" dx-popup="conditionalFormattingPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div style="margin:5px;min-height:30px">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">Select an existing rule..</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:50%;" id="existingConditionalFormattingRules" dx-select-box="existingConditionalFormattingRulesSelectBoxOptions"></div>\r\n                        <div style="float:right;width:20%;" dx-button="deleteExistingRuleButtonOptions"></div>\r\n                        <div style="float:right;width:20%;" dx-button="loadExistingRuleButtonOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">...or create a new one</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:49%;margin-right:5px;" id="conditionFormatingTargetColumn" dx-select-box="conditionalFormatingAvailableTargetColumnsOptions"></div>\r\n                        <div style="float:right;width:50%;" dx-select-box="consitionalFormattingAvailableColumnsSelectBoxOptions"></div>\r\n                    </div>\r\n                    <div style="float:left;width:100%;margin-top:5px;" dx-text-box="conditionalFormatingExpressionTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="margin:5px;float:left;width:65%;">\r\n                    <div style="top:50px;margin:5px;width:100%;" id="ruleTestingGrid" dx-data-grid="conditionalFormattingResultGridPopupOptions"></div>\r\n                </div>\r\n                <div style="margin:5px;float:right;width:30%;">\r\n                    <div id="conditionalFormattingRuleList" dx-list="rulesListOptions"></div>\r\n                    <div style="margin-top:10px;" dx-color-box="conditionalFormattingColorBox"></div>\r\n                    <div style="margin-top:10px;" dx-select-box="availableIconsSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="float:left;width:48%;margin-bottom:20px;" dx-button="conditionalFormattingTestExpressionButtonOptions"></div>\r\n                <div style="float:right;width:48%;margin-bottom:20px;" dx-button="createConditionalFormattingButtonOptions"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="customColumnConsole" dx-popup="customColumnPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Select an existing custom column...</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:40%;" id="existingCustomColumns" dx-select-box="existingCustomColumnsSelectBoxOptions"></div>\r\n                    <div style="float:right;width:28%;margin:0px;" dx-button="deleteExistingCustomColumnButtonOptions"></div>\r\n                    <div style="float:right;width:27%;margin:0px 5px 0px 0px;" dx-button="loadExistingCustomColumnButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">...or create a new one</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:25%;margin-right:5px;" id="customColumnColumnName" dx-text-box="customColumnNameTextBoxOptions"></div>\r\n                    <div style="float:left;width:35%;" id="customColumnAvailableColumnsFormat" dx-select-box="customColumnAvailableFormattingSelectBoxOptions"></div>\r\n                    <div style="float:right;width:35%;" id="customColumnAvailableColumns" dx-select-box="customColumnAvailableColumnsSelectBoxOptions"></div>\r\n                </div>\r\n                <div style="width:100%;" dx-text-box="customColumnExpressionTextBoxOptions"></div>\r\n                <div style="width:100%;margin-top:5px;min-height:30px;">\r\n                    <div style="float:left;width:50%;margin:0px 5px 0px 0px;" dx-button="customColumnTestExpressionButtonOptions"></div>\r\n                    <div style="float:right;width:49%;margin:0px" dx-button="createRuleButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="margin-top:10px;">\r\n            <div style="bottom:0;margin:5px;width:100%;" id="customColumnTestingGrid" dx-data-grid="customColumnResultGridOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnManagementPopup" dx-popup="columnManagementPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Name</div>\r\n                <div class="dx-field-value">\r\n                    <div dx-text-box="columnManagementColumnNameTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Format</div>\r\n                <div class="dx-field-value">\r\n                    <div id="columnManagementAvailableColumnsFormat" dx-select-box="columnManagementAvailableFormattingSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="width:100%;margin-top:5px;min-height:30px;">\r\n            <div style="width:100%;margin:0px" dx-button="columnManagementValidateButtonOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnChooserConsole" dx-popup="columnChooserPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div id="columnChooserGrid" style="margin:10px" dx-data-grid="columnChooserGridOptions"></div>\r\n        <div style="width:100%;margin-top:10px;min-height:30px;" dx-button="columnChooserValidateButtonOptions"></div>\r\n    </div>\r\n</div>\r\n'),n.put("view.grid.flat.html",'<div id="flatGrid" dx-data-grid="flatGridOptions"></div>\r\n'),n.put("view.grid.tree.html",'<div id="treeGrid" dx-tree-list="treeListOptions"></div>\r\n'),n.put("view.tree.grid.management.html",'<div class="popup" id="conditionalFormattingConsole" dx-popup="conditionalFormattingPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div style="margin:5px;min-height:30px">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">Select an existing rule..</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:50%;" id="existingConditionalFormattingRules" dx-select-box="existingConditionalFormattingRulesSelectBoxOptions"></div>\r\n                        <div style="float:right;width:20%;" dx-button="deleteExistingRuleButtonOptions"></div>\r\n                        <div style="float:right;width:20%;" dx-button="loadExistingRuleButtonOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">...or create a new one</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:49%;margin-right:5px;" id="conditionFormatingTargetColumn" dx-select-box="conditionalFormatingAvailableTargetColumnsOptions"></div>\r\n                        <div style="float:right;width:50%;" dx-select-box="consitionalFormattingAvailableColumnsSelectBoxOptions"></div>\r\n                    </div>\r\n                    <div style="float:left;width:100%;margin-top:5px;" dx-text-box="conditionalFormatingExpressionTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="margin:5px;float:left;width:65%;">\r\n                    <div style="top:50px;margin:5px;width:100%;" id="ruleTestingGrid" dx-data-grid="conditionalFormattingResultGridPopupOptions"></div>\r\n                </div>\r\n                <div style="margin:5px;float:right;width:30%;">\r\n                    <div id="conditionalFormattingRuleList" dx-list="rulesListOptions"></div>\r\n                    <div style="margin-top:10px;" dx-color-box="conditionalFormattingColorBox"></div>\r\n                    <div style="margin-top:10px;" dx-select-box="availableIconsSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="float:left;width:48%;margin-bottom:20px;" dx-button="conditionalFormattingTestExpressionButtonOptions"></div>\r\n                <div style="float:right;width:48%;margin-bottom:20px;" dx-button="createConditionalFormattingButtonOptions"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="customColumnConsole" dx-popup="customColumnPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Select an existing custom column...</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:40%;" id="existingCustomColumns" dx-select-box="existingCustomColumnsSelectBoxOptions"></div>\r\n                    <div style="float:right;width:28%;margin:0px;" dx-button="deleteExistingCustomColumnButtonOptions"></div>\r\n                    <div style="float:right;width:27%;margin:0px 5px 0px 0px;" dx-button="loadExistingCustomColumnButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">...or create a new one</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:25%;margin-right:5px;" id="customColumnColumnName" dx-text-box="customColumnNameTextBoxOptions"></div>\r\n                    <div style="float:left;width:35%;" id="customColumnAvailableColumnsFormat" dx-select-box="customColumnAvailableFormattingSelectBoxOptions"></div>\r\n                    <div style="float:right;width:35%;" id="customColumnAvailableColumns" dx-select-box="customColumnAvailableColumnsSelectBoxOptions"></div>\r\n                </div>\r\n                <div style="width:100%;" dx-text-box="customColumnExpressionTextBoxOptions"></div>\r\n                <div style="width:100%;margin-top:5px;min-height:30px;">\r\n                    <div style="float:left;width:50%;margin:0px 5px 0px 0px;" dx-button="customColumnTestExpressionButtonOptions"></div>\r\n                    <div style="float:right;width:49%;margin:0px" dx-button="createRuleButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="margin-top:10px;">\r\n            <div style="bottom:0;margin:5px;width:100%;" id="customColumnTestingGrid" dx-data-grid="customColumnResultGridOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnManagementPopup" dx-popup="columnManagementPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Name</div>\r\n                <div class="dx-field-value">\r\n                    <div dx-text-box="columnManagementColumnNameTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Format</div>\r\n                <div class="dx-field-value">\r\n                    <div id="columnManagementAvailableColumnsFormat" dx-select-box="columnManagementAvailableFormattingSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="width:100%;margin-top:5px;min-height:30px;">\r\n            <div style="width:100%;margin:0px" dx-button="columnManagementValidateButtonOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnChooserConsole" dx-popup="columnChooserPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div id="columnChooserGrid" style="margin:10px" dx-data-grid="columnChooserGridOptions"></div>\r\n        <div style="width:100%;margin-top:10px;min-height:30px;" dx-button="columnChooserValidateButtonOptions"></div>\r\n    </div>\r\n</div>\r\n')}]),dxGridExtension.factory("conditionalFormattingConfiguration",["$log",function($log){function applyConditionalFormattingExpressionOnCell(cell,rule,dataSource){try{if("data"==cell.rowType&&!dxGridExtensions.isUndefinedOrNull(rule)&&!dxGridExtensions.isUndefinedOrNull(cell.value)&&rule.target==cell.column.dataField&&null!=cell.data){var self=this;if(rule.isExpressionBased){var expression=rule.expression,replacement={},processedExpression=expression,row=cell.row.data;_.forEach(row,function(n,t){dxGridExtensions.initFormulas(self);var e="string"==typeof n?"'"+n+"'":n;processedExpression=processedExpression.split("["+t+"]").join(" "+e+" ")});var result=eval(processedExpression);result&&rule.formatting(cell,rule)}else rule.formatting(cell,rule,dataSource)}}catch(n){$log.error(n)}}var rules=[{key:"Auto set",items:[{text:"Proportional Bars",isExpressionBased:!1,formatting:function(n,t,e){if("number"==n.column.dataType&&!(n.value<0)){var o=_.sumBy(e,function(n){return null!=n[t.target]&&n[t.target]>0?n[t.target]:0}),i="<div><div class='formatting bar superpose' style='background:"+t.color+";width:"+n.value/o*100+"%;''></div> <div class='formatting superpose'  style='z-index: 10;margin-top:-16px;'>"+n.text+"  </div></div>";n.cellElement.html(i)}}},{text:"Up/Down colors",isExpressionBased:!1,formatting:function(n,t){"number"==n.column.dataType&&(n.value>0?n.cellElement.css("color","green"):n.cellElement.css("color","red"))}},{text:"Up/Down icon",isExpressionBased:!1,formatting:function(n,t){"number"==n.column.dataType&&(n.value>0?n.cellElement.append('<span class="cb cb-chevron-up" style="color:green;"></span>'):n.cellElement.append('<span class="cb cb-chevron-down" style="color:red;"></span>'))}}]},{key:"Expression based",items:[{text:"Text color",isExpressionBased:!0,formatting:function(n,t){$(n.cellElement[0]).css("color",t.color)}},{text:"Background Color",isExpressionBased:!0,formatting:function(n,t){$(n.cellElement[0]).css("background-color",t.color)}},{text:"Icon",isExpressionBased:!0,formatting:function(n,t){n.cellElement.append('<span class="'+t.icon+'" style="color: '+t.color+';"></span>')}}]}],icons=[{name:"Arrow up",css:"cb cb-arrow-up"},{name:"Arrow down",css:"cb cb-arrow-down"},{name:"Chevron up",css:"cb cb-chevron-up"},{name:"Chevron down",css:"cb cb-chevron-down"},{name:"Spin up",css:"cb cb-spin-up"},{name:"Spin down",css:"cb cb-spin-down"},{name:"Favorites",css:"cb cb-favorites"},{name:"Like",css:"cb cb-like"},{name:"Info",css:"cb cb-info"},{name:"Todo",css:"cb cb-todo"}],getRuleTemplate=function(n){var t=getAllRules(),e=_.find(t,function(t){return t.text===n});return _.clone(e)},getRuleFromdescriptor=function(n){var t=getRuleTemplate(n.text);return _.extend(t,n)},getAllRules=function(){return _.transform(rules,function(n,t){_.each(t.items,function(t){n.push(t)},[])})},createRule=function(n,t,e,o,i){var l=getRuleTemplate(n);if(dxGridExtensions.isUndefinedOrNull(l))throw new Error("Rule "+n+" does not exist");return l.target=t,l.expression=e,l.color=o,l.icon=i,l};return{getRuleFromdescriptor:getRuleFromdescriptor,createRule:createRule,applyConditionalFormattingExpressionOnCell:applyConditionalFormattingExpressionOnCell,getAllRules:getAllRules,availableRules:rules,availableIcons:icons}}]),dxGridExtension.service("customColumnConfiguration",["$log",function($log){this.createCustomColumn=function(n,t,e){return{name:n,expression:t,format:e}},this.computeCustomColumn=function(rule,datasource){try{var self=this,expression=rule.expression,replacement={},processedExpression=expression;_.forEach(datasource,function(item){dxGridExtensions.initFormulas(self),_.forEach(item,function(n,t){var e="string"==typeof n?"'"+n+"'":n;processedExpression=processedExpression.split("["+t+"]").join(" "+e+" ")});var result=eval(processedExpression);item[rule.name]=result,processedExpression=expression})}catch(n){$log.error(n)}},this.customColumnFormats=[{text:"string",value:{dataType:"string",format:{type:"",precision:0}}},{text:"integer",value:{dataType:"number",format:{type:"fixedpoint",precision:0}}},{text:"percentage 2",value:{dataType:"number",format:{type:"percent",precision:2}}},{text:"percentage 5",value:{dataType:"number",format:{type:"percent",precision:5}}},{text:"decimal 2",value:{dataType:"number",format:{type:"fixedpoint",precision:2}}},{text:"decimal 5",value:{dataType:"number",format:{type:"fixedpoint",precision:5}}},{text:"boolean",value:{dataType:"boolean",format:{type:"",precision:0}}}]}]);