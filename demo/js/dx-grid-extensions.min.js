/**
 * DxGridExtensions - 1.0.0.1
 */

"use strict";function _defineProperty(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}!function(){window.dxGridExtensions={isUndefinedOrNull:function(n){return angular.isUndefined(n)||null===n}},window.dxGridExtensions.groupCellTemplate=function(n,e){$("<div>").html(e.text).appendTo(n)},window.dxGridExtensions.isInt=function(n){return!isNaN(Number(n))&&Number(n)%1==0},window.dxGridExtensions.isFloat=function(n){return!isNaN(Number(n))&&Number(n)%1!=0},window.dxGridExtensions.resetSelectBoxValue=function(n){var e=$(n).dxSelectBox("instance");dxGridExtensions.isUndefinedOrNull(e)||e.option("value",null)},window.dxGridExtensions.initFormulas=function(n){n.AND=formulajs.AND,n.OR=formulajs.OR,n.NOT=formulajs.NOT,n.IF=formulajs.IF,n.ISNULL=formulajs.ISNULL,n.CEILING=formulajs.CEILING,n.EXP=formulajs.EXP,n.FLOOR=formulajs.FLOOR,n.MAX=formulajs.MAX,n.MIN=formulajs.MIN,n.POW=formulajs.POW,n.RAND=formulajs.RAND,n.RANDBETWEEN=formulajs.RANDBETWEEN,n.ROUND=formulajs.ROUND,n.SIGN=formulajs.SIGN,n.DECIMAL=formulajs.DECIMAL,n.INT=formulajs.INT,n.CONCATENATE=formulajs.CONCATENATE,n.CONTAINS=formulajs.CONTAINS,n.LEN=formulajs.LEN,n.LOWER=formulajs.LOWER,n.MID=formulajs.MID,n.TRIM=formulajs.TRIM,n.UPPER=formulajs.UPPER,n.TODAY=formulajs.TODAY,n.WEEKDAY=formulajs.WEEKDAY,n.MONTH=formulajs.MONTH,n.YEAR=formulajs.YEAR}}(),angular.module("dxGridExtensionTemplates",[]);var dxGridExtension=angular.module("dxGridExtension",["dx","dxGridExtensionTemplates"]);dxGridExtension.controller("columnChooser",["$scope","$controller","$timeout","customColumnConfiguration",function(n,e,t,o){function i(n){return _.find(o.customColumnFormats,function(e){if(e.value.dataType==n.dataType){if(dxGridExtensions.isUndefinedOrNull(e.value.format))return!1;if(e.value.format.type==n.format.type&&e.value.format.precision==n.format.precision)return!0}return!1})}function a(){for(var e=n.management.instance.columnCount(),t=[],o=0;o<e;o++)t.push(n.management.instance.columnOption(o));return t}function l(e){e.find(".dragRow").draggable({helper:"clone",scroll:!0,axis:"y",drag:function(e,t){var o=n.columnChooserGrid.height()+n.columnChooserGrid.offset().top-100,i=n.columnChooserGrid.offset().top+100;if(t.offset.top<i){l=(a=n.columnChooserGrid.dxDataGrid("instance").getScrollable()).scrollOffset().top-30<0?0:a.scrollOffset().top-30;a.scrollTo(l)}if(t.offset.top>o){var a=n.columnChooserGrid.dxDataGrid("instance").getScrollable(),l=a.scrollOffset().top+30;a.scrollTo(l)}},start:function(n,e){for(var t=$(this),o=e.helper,i=t.children(),a=o.children(),l=0;l<i.length;l++)$(a.get(l)).width($(i.get(l)).width());o.width(t.width()),o.addClass("drag-helper")}}),e.find(".dragRow").droppable({drop:function(t,o){var i=o.draggable.data("keyValue"),a=$(this).data("keyValue");if(!dxGridExtensions.isUndefinedOrNull(a)){var l=null,s=null;n.columnChooserDataSource.byKey(i).done(function(n){l=n.position}),n.columnChooserDataSource.byKey(a).done(function(n){s=n.position});var r=s<l?1:-1,m=null;n.columnChooserDataSource.load().done(function(n){m=n});for(var u=0;u<m.length;u++)m[u].position>Math.min(s,l)&&m[u].position<Math.max(s,l)&&(m[u].position+=r);n.columnChooserDataSource.update(i,{position:s}),n.columnChooserDataSource.update(a,{position:s+r}),e.dxDataGrid("instance").refresh()}}})}function s(e,t){e.dataType=t.value.dataType,e.format={type:null,precision:null},dxGridExtensions.isUndefinedOrNull(t.value.format)||(e.format.type=t.value.format.type,e.format.precision=t.value.format.precision);var o=_.find(n.management.groupItems,function(n){return n.column===e.dataField});dxGridExtensions.isUndefinedOrNull(o)||(dxGridExtensions.isUndefinedOrNull(t.value.format)?(o.valueFormat.type=null,o.valueFormat.precision=null):(o.valueFormat.type=t.value.format.type,o.valueFormat.precision=t.value.format.precision))}function r(e){_.remove(n.management.groupItems,function(n){return n.column===e})}function m(e){if(null!=n.management.currentColumn&&"string"!=n.management.currentColumn.dataType){var t=_.find(n.management.groupItems,function(n){return n.column===e});if(dxGridExtensions.isUndefinedOrNull(t)){var o=createDefaultNumberGroupItem(e);n.management.groupItems.push(o)}}}function u(e,t){var o=i(e);return{id:t,dataField:e.dataField,caption:e.caption+"",visible:e.visible,hasAggregation:!dxGridExtensions.isUndefinedOrNull(_.find(n.management.groupItems,function(n){return n.column==e.dataField})),position:e.visibleIndex,format:o.text}}n.columnChooserGrid,n.management.showColumnChooserConsole=!1,n.getAllColumns=a,n.getColumnFormat=i,n.columnChooserDataSource=new DevExpress.data.ArrayStore({data:[]}),n.$watch("management.showColumnChooserConsole",function(){n.management.showColumnChooserConsole&&t(function(){n.columnChooserDataSource.clear();var e=a(),t=0;_.forEach(e,function(e){n.columnChooserDataSource.insert(u(e,t++))}),n.columnChooserGrid.dxDataGrid("instance").refresh()},500)}),n.columnChooserPopupOptions={width:800,contentTemplate:"info",height:"100%",dragEnabled:!0,showTitle:!0,closeOnOutsideClick:!1,title:"Management - Columns",bindingOptions:{visible:"management.showColumnChooserConsole"}},n.columnChooserGridOptions={dataSource:{store:n.columnChooserDataSource,sort:"position"},height:"90%",width:"100%",resize:!1,onContentReady:function(n){l(n.element)},onInitialized:function(e){n.columnChooserGrid=e.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},filterRow:{visible:!0},sorting:{mode:"none"},hoverStateEnabled:!0,controlColumnResizing:!1,showRowLines:!0,showColumnLines:!0,selection:{mode:"single"},onRowValidating:function(n){n.valid=!0},onRowPrepared:function(n){"data"==n.rowType&&(n.rowElement.addClass("dragRow"),n.rowElement.data("keyValue",n.key))},editing:{mode:"cell",allowUpdating:!0},columnChooser:{enabled:!0},columns:[{dataField:"caption",caption:"Caption"},{dataField:"hasAggregation",caption:"Aggregation",dataType:"boolean",allowFiltering:!0,visible:!1},{dataField:"visible",caption:"Visible",dataType:"boolean",allowFiltering:!0,filterValue:!0},{dataField:"format",caption:"Format",lookup:{allowClearing:!1,dataSource:o.customColumnFormats,displayExpr:"text",valueExpr:"text"},allowFiltering:!1,visible:!1},{dataField:"position",caption:"Position",visible:!1,allowFiltering:!1}]},n.columnChooserValidateButtonOptions={text:"Validate changes",onClick:function(){n.columnChooserGrid.dxDataGrid("instance").saveEditData().then(function(e){n.safeUpdate(function(){_.forEach(n.columnChooserDataSource._array,function(e){var t=_.find(n.management.columns,function(n){return e.dataField===n.dataField});t.visibleIndex=e.position,t.caption=e.caption,t.visible=e.visible,e.hasAggregation?m(e.dataField):r(e.dataField),s(t,_.find(o.customColumnFormats,function(n){return n.text==e.format}))}),t(function(){n.management.instance.option("columns",n.management.columns),n.canGroup&&n.management.instance.option("summary.groupItems",n.management.groupItems)},500)}),n.management.showColumnChooserConsole=!1})}}}]),dxGridExtension.controller("conditionalFormatting",["$scope","$controller","$timeout","conditionalFormattingConfiguration","customColumnConfiguration",function(n,e,t,o,i){function a(){return o.createRule(n.selectedConditionalFormattingRule.text,n.conditionalFormatingTargetColumn,n.conditionalFormatingExpressionText,n.currentConditionalFormattingColor,n.selectedConditionalFormattingIcon)}function l(){if(s(),!dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingGrid)){var e=n.conditionalFormatingGrid.dxDataGrid("instance");if(!dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)){var t=a();e.option("onCellPrepared",function(e){o.applyConditionalFormattingExpressionOnCell(e,t,n.conditionalFormattingResult)}),e.repaint()}}}function s(){try{n.conditionalFormattingResult=[];var e=n.conditionalFormatingExpressionText;n.conditionalFormattingExpressionTargetedColumns=""===n.expression?[]:e.match(/\[(.*?)\]/g),_.each(n.management.datasource,function(e){var t={};_.each(n.conditionalFormattingExpressionTargetedColumns,function(o){var a=o.substring(1,o.length-1);if(!e.hasOwnProperty(a))throw new Error("Column "+a+" does not exist");var l=_.find(n.management.customColumns,function(n){return n.dataField==a});t[a]=l?i.computeCustomColumn(l.expression,e):e[a]});var o=e[n.conditionalFormatingTargetColumn],a=_.find(n.management.customColumns,function(e){return e.dataField==n.conditionalFormatingTargetColumn});a&&(o=i.computeCustomColumn(a.expression,e)),t[n.conditionalFormatingTargetColumn]=o,n.conditionalFormattingResult.push(t)})}catch(e){return void n.conditionalFormattingResult.push({error:e.message})}}function r(){null==n.conditionalFormatingTargetColumn||dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)?n.isCreateRuleDisabled=!0:n.selectedConditionalFormattingRule.isExpressionBased&&""===n.conditionalFormatingExpressionText?n.isCreateRuleDisabled=!0:n.isCreateRuleDisabled=!1}var m,u=o.availableIcons[0];n.management.showConditionalFormattingConsole=!1,n.conditionalFormatingGrid=null,n.conditionalFormattingResult=[],n.expressionCompliantColumns=[],n.conditionalFormatingExpressionText="",n.isExpressionDisabled=!0,n.isCreateRuleDisabled=!0,n.conditionalFormattingExpressionTargetedColumns=[],n.selectedExistingConditionalFormattingRule=null,n.conditionalFormatingTargetColumn=null,n.selectedConditionalFormattingRule=null,n.selectedConditionalFormattingRules=[],n.currentConditionalFormattingColor="#ff2600",n.selectedConditionalFormattingIcon=u,n.management.conditionalFormattingRules=_.transform(n.management.conditionalFormattingRules,function(n,e){n.push(o.getRuleFromdescriptor(e))},[]),n.$watch("selectedConditionalFormattingIcon",function(){dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||(n.selectedConditionalFormattingRule.icon=n.selectedConditionalFormattingIcon,l())}),n.$watch("currentConditionalFormattingColor",function(){if(!(dxGridExtensions.isUndefinedOrNull(n.currentConditionalFormattingColor)||dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingGrid)||dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule))){var e=n.conditionalFormatingGrid.dxDataGrid("instance");dxGridExtensions.isUndefinedOrNull(e)||(n.selectedConditionalFormattingRule.color=n.currentConditionalFormattingColor,l())}}),n.$watch("selectedConditionalFormattingRule",function(){r(),dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||(n.isExpressionDisabled=!n.selectedConditionalFormattingRule.isExpressionBased,l())}),n.$watch("conditionalFormatingExpressionText",function(){r(),dxGridExtensions.isUndefinedOrNull(n.selectedConditionalFormattingRule)||""===n.conditionalFormatingExpressionText&&(n.conditionalFormattingResult=[])}),n.$watch("management.showConditionalFormattingConsole",function(){dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingGrid)||n.conditionalFormatingGrid.dxDataGrid("instance").option("dataSource",null),n.expressionCompliantColumns=_(n.management.columns).sortBy(function(n){return n.dataField}).value(),n.conditionalFormatingExpressionText="",n.selectedConditionalFormattingIcon=u,n.currentConditionalFormattingColor="#ff2600",n.conditionalFormatingTargetColumn=null,dxGridExtensions.resetSelectBoxValue("#conditionalFormatingTargetColumn")}),n.$watch("conditionalFormatingTargetColumn",function(){r(),dxGridExtensions.isUndefinedOrNull(n.conditionalFormatingTargetColumn)||l()}),n.$watch("selectedConditionalFormattingRules",function(){0!=n.selectedConditionalFormattingRules.length&&(n.selectedConditionalFormattingRule=n.selectedConditionalFormattingRules[0].items[0],n.selectedConditionalFormattingRule.isExpressionBased||(n.conditionalFormatingExpressionText=""))}),n.$watch("selectedExistingConditionalFormattingRule",function(){n.isExistingRuleActionDisabled=dxGridExtensions.isUndefinedOrNull(n.selectedExistingConditionalFormattingRule)}),n.conditionalFormattingAvailableColumnsSelectBoxOptions={bindingOptions:{items:"expressionCompliantColumns",value:"selectedAvailableColumn",disabled:"isExpressionDisabled"},displayExpr:"dataField",valueExpr:"dataField",onItemClick:function(e){n.conditionalFormatingExpressionText+="["+e.itemData.dataField+"]",n.selectedAvailableColumn=null,dxGridExtensions.resetSelectBoxValue("#conditionalFormattingAvailableColumns")},placeholder:"Add column to expression"},n.conditionalFormattingTestExpressionButtonOptions={icon:"fa fa-hacker-news",text:"Test expression",bindingOptions:{disabled:"isCreateRuleDisabled"},onClick:function(){l()}},n.conditionalFormattingPopupOptions=(m={width:750,contentTemplate:"info",showTitle:!1,height:"auto"},_defineProperty(m,"showTitle",!0),_defineProperty(m,"title","Management - Conditional Formatting"),_defineProperty(m,"dragEnabled",!0),_defineProperty(m,"closeOnOutsideClick",!0),_defineProperty(m,"bindingOptions",{visible:"management.showConditionalFormattingConsole"}),m),n.conditionalFormattingExpressionTextBoxOptions={bindingOptions:{value:"conditionalFormatingExpressionText",disabled:"isExpressionDisabled"},placeholder:"Enter expression...",showClearButton:!0},n.conditionalFormattingcreateButtonOptions={icon:"fa fa-hacker-news",text:"Create expression",bindingOptions:{disabled:"isCreateRuleDisabled"},onClick:function(e){n.conditionalFormattingCreateRule()}},n.conditionalFormattingAvailableTargetColumnsOptions={bindingOptions:{items:"expressionCompliantColumns"},onItemClick:function(e){n.conditionalFormatingTargetColumn=e.itemData.dataField},displayExpr:"dataField",placeholder:"Choose target column..."},n.conditionalFormattingResultGridPopupOptions={bindingOptions:{dataSource:"conditionalFormattingResult"},height:350,resize:!1,onInitialized:function(e){n.conditionalFormatingGrid=e.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},loadPanel:{enabled:!0},hoverStateEnabled:!0,controlColumnResizing:!0,showRowLines:!0,showColumnLines:!1,selection:{mode:"single"},sorting:{mode:"multiple"}},n.rulesListOptions={bindingOptions:{selectedItems:"selectedConditionalFormattingRules"},showSelectionControls:!0,selectionMode:"single",selectAllMode:"allPages",items:o.availableRules,height:"50%",grouped:!0,collapsibleGroups:!0,groupTemplate:function(n){return $("<div>Type: "+n.key+"</div>")}},n.conditionalFormattingColorBox={bindingOptions:{value:"currentConditionalFormattingColor"},applyValueMode:"instantly"},n.condtionalFormattingAvailableIconsSelectBoxOptions={dataSource:o.availableIcons,displayExpr:"name",valueExpr:"css",bindingOptions:{value:"selectedConditionalFormattingIcon"},placeholder:"Select an icon..."},n.conditionalFormattingDeleteExistingRuleButtonOptions={text:"Delete",bindingOptions:{disabled:"isExistingRuleActionDisabled"},onClick:function(){_.remove(n.management.conditionalFormattingRules,{target:n.selectedExistingConditionalFormattingRule.target}),n.management.instance.repaint(),n.management.showConditionalFormattingConsole=!1}},n.conditionalFormattingLoadExistingRuleButtonOptions={text:"Load",bindingOptions:{disabled:"isExistingRuleActionDisabled"},onClick:function(){n.conditionalFormatingTargetColumn=n.selectedExistingConditionalFormattingRule.target,n.conditionalFormatingExpressionText=n.selectedExistingConditionalFormattingRule.expression,n.currentConditionalFormattingColor=n.selectedExistingConditionalFormattingRule.color,n.selectedConditionalFormattingIcon=n.selectedExistingConditionalFormattingRule.icon,$("#conditionalFormattingRuleList").dxList("instance").selectItem(_.find(o.getAllRules(),function(e){return e.text==n.selectedExistingConditionalFormattingRule.text}))}},n.conditionalFormattingExistingRulesSelectBoxOptions={displayExpr:"target",bindingOptions:{dataSource:"management.conditionalFormattingRules",value:"selectedExistingConditionalFormattingRule"},placeholder:"Load existing rule..."},n.conditionalFormattingCreateRule=function(){if(!dxGridExtensions.isUndefinedOrNull(n.management.instance)){var e=a();_.remove(n.management.conditionalFormattingRules,{target:e.target}),n.management.conditionalFormattingRules.push(e),n.management.instance.repaint(),n.management.showConditionalFormattingConsole=!1}}}]),dxGridExtension.controller("customColumns",["$scope","$controller","$timeout","$log","customColumnConfiguration",function(n,e,t,o,i){function a(e){n.management.customColumns.push(e),n.management.columns.push(e),"number"!==n.customColumnFormating.dataType||dxGridExtensions.isUndefinedOrNull(n.management.groupItems)||n.management.groupItems.push({column:e.dataField,summaryType:"sum",showInGroupFooter:!1,alignByColumn:!0,valueFormat:{type:n.customColumnFormating.format.type,precision:n.customColumnFormating.format.precision},displayFormat:"{0}"})}function l(e){_.remove(n.management.customColumns,{name:e}),_.remove(n.management.columns,{dataField:e}),_.remove(n.management.groupItems,{column:e}),n.management.instance.repaint()}function s(){try{n.customColumnResult=[];var e=n.customColumnExpressionText,o=e.match(/\[(.*?)\]/g);if(_.each(n.management.datasource,function(t){var a={};_.each(o,function(n){var e=n.substring(1,n.length-1);if(!t.hasOwnProperty(e))throw new Error("Column "+e+" does not exist");a[e]=t[e]}),a[n.customColumnName]=i.computeCustomColumn(e,t),n.customColumnResult.push(a)}),dxGridExtensions.isUndefinedOrNull(n.customColumnGrid))return;t(function(){var e=n.customColumnGrid.dxDataGrid("instance");e.columnOption(n.customColumnName,"dataType",n.customColumnFormating.dataType),null!=n.customColumnFormating.format&&e.columnOption(n.customColumnName,"format",{type:n.customColumnFormating.format.type,precision:n.customColumnFormating.format.precision})},500)}catch(e){return void n.customColumnResult.push({error:e.message})}}function r(){n.cannotCreateColumn=""==n.customColumnFormating||""==n.customColumnExpressionText||dxGridExtensions.isUndefinedOrNull(n.customColumnName)||dxGridExtensions.isUndefinedOrNull(n.customColumnFormating)}n.management.showCustomColumnConsole=!1,n.customColumnGrid=null,n.customColumnExpressionText="",n.customColumnName=null,n.customColumnResult=[],n.customColumnSelectedAvailableColumn=null,n.customColumnFormating=null,n.cannotCreateColumn=!0,n.isExistingRuleActionDisabled=!0,n.selectedExistingCustomColumn=null,n.isExistingCustomColumnActionDisabled=!1,n.expressionCompliantColumns=[],n.$watch("management.showCustomColumnConsole",function(){n.management.showCustomColumnConsole&&(dxGridExtensions.isUndefinedOrNull(n.customColumnGrid)||n.customColumnGrid.dxDataGrid("instance").option("dataSource",null),n.customColumnExpressionText="",n.customColumnName="",n.customColumnSelectedAvailableColumn=null,dxGridExtensions.resetSelectBoxValue("#customColumnAvailableColumnsFormat"),dxGridExtensions.resetSelectBoxValue("#existingCustomColumns"),n.expressionCompliantColumns=_(n.management.columns).filter(function(n){return!n.isCustomColumn}).sortBy(function(n){return n.dataField}).value(),n.selectedExistingCustomColumn="",n.customColumnFormating="")}),n.$watch("customColumnExpressionText",function(){r()}),n.$watch("customColumnName",function(){r()}),n.$watch("customColumnFormating",function(){r()}),n.$watch("selectedExistingCustomColumn",function(){n.isExistingCustomColumnActionDisabled=dxGridExtensions.isUndefinedOrNull(n.selectedExistingCustomColumn)||""==n.selectedExistingCustomColumn}),n.customColumnResultGridOptions={bindingOptions:{dataSource:"customColumnResult"},height:200,resize:!1,onInitialized:function(e){n.customColumnGrid=e.element},allowColumnResizing:!0,scrolling:{mode:"virtual"},loadPanel:{enabled:!0},hoverStateEnabled:!0,controlColumnResizing:!0,showRowLines:!0,showColumnLines:!1,selection:{mode:"single"},sorting:{mode:"multiple"}},n.customColumnAvailableColumnsSelectBoxOptions={bindingOptions:{items:"expressionCompliantColumns",value:"customColumnSelectedAvailableColumn"},displayExpr:"dataField",onItemClick:function(e){n.customColumnExpressionText+="["+e.itemData.dataField+"]",n.customColumnSelectedAvailableColumn=null,dxGridExtensions.resetSelectBoxValue("#customColumnAvailableColumns")},placeholder:"Add column to expression"},n.customColumnAvailableFormattingSelectBoxOptions={displayExpr:"text",valueExpr:"value",items:i.customColumnFormats,bindingOptions:{value:"customColumnFormating"},placeholder:"Choose column format"},n.customColumnPopupOptions={width:900,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,title:"Management - Custom Columns",closeOnOutsideClick:!0,bindingOptions:{visible:"management.showCustomColumnConsole"}},n.customColumnNameTextBoxOptions={bindingOptions:{value:"customColumnName"},placeholder:"Enter column name...",showClearButton:!0},n.customColumnExpressionTextBoxOptions={bindingOptions:{value:"customColumnExpressionText"},placeholder:"Enter expression...",showClearButton:!0},n.customColumnTestExpressionButtonOptions={icon:"fa fa-hacker-news",text:"Test expression",bindingOptions:{disabled:"cannotCreateColumn"},onClick:s},n.customColumncreateRuleButtonOptions={icon:"fa fa-hacker-news",text:"Create column",bindingOptions:{disabled:"cannotCreateColumn"},onClick:function(e){n.customColumnCreateColumn()}},n.customColumndeleteExistingCustomColumnButtonOptions={text:"Delete",bindingOptions:{disabled:"isExistingCustomColumnActionDisabled"},onClick:function(){l(n.selectedExistingCustomColumn.name),n.management.showCustomColumnConsole=!1}},n.customColumnloadExistingCustomColumnButtonOptions={text:"Load",bindingOptions:{disabled:"isExistingCustomColumnActionDisabled"},onClick:function(){n.customColumnName=n.selectedExistingCustomColumn.name,n.customColumnExpressionText=n.selectedExistingCustomColumn.expression,n.customColumnFormating=n.selectedExistingCustomColumn.formatting}},n.customColumnExistingCustomColumnsSelectBoxOptions={displayExpr:"name",bindingOptions:{dataSource:"management.customColumns",value:"selectedExistingCustomColumn"},placeholder:"Load existing column..."},n.customColumnCreateColumn=function(){if(s(),!dxGridExtensions.isUndefinedOrNull(n.management.instance)){var e=i.createCustomColumn(n.customColumnName,n.customColumnExpressionText,n.customColumnFormating,n.management.currentColumn.visibleIndex);l(e.name),a(e),n.management.showCustomColumnConsole=!1}}}]),dxGridExtension.controller("columnManagement",["$scope","$controller","$timeout","customColumnConfiguration",function(n,e,t,o){n.management.showColumnManagementConsole=!1,n.columnManagementColumnName,n.columnManagementColumnFormating,n.cannotValidateChange,n.columnManagementPopupOptions={width:350,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,closeOnOutsideClick:!0,bindingOptions:{visible:"management.showColumnManagementConsole",title:"columnManagementColumnName"}},n.$watch("management.showColumnManagementConsole",function(){!dxGridExtensions.isUndefinedOrNull(n.management.currentColumn)&&n.management.showColumnManagementConsole&&(n.columnManagementColumnName=n.management.currentColumn.caption,n.columnManagementColumnFormating=_.find(o.customColumnFormats,function(e){if(e.value.dataType==n.management.currentColumn.dataType)if(dxGridExtensions.isUndefinedOrNull(n.management.currentColumn.format)){if(dxGridExtensions.isUndefinedOrNull(e.value.format))return!0}else{if(dxGridExtensions.isUndefinedOrNull(e.value.format))return!1;if(e.value.format.type==n.management.currentColumn.format.type&&e.value.format.precision==n.management.currentColumn.format.precision)return!0}return!1}))}),n.$watch("columnManagementColumnName",function(){n.cannotValidateChange=""==n.columnManagementColumnName}),n.columnManagementColumnNameTextBoxOptions={bindingOptions:{value:"columnManagementColumnName"},onInput:function(e){n.cannotValidateChange=""==e.component._options.text},showClearButton:!0},n.columnManagementAvailableFormattingSelectBoxOptions={displayExpr:"text",items:o.customColumnFormats,bindingOptions:{value:"columnManagementColumnFormating"}},n.columnManagementValidateButtonOptions={text:"Validate changes",bindingOptions:{disabled:"cannotValidateChange"},onClick:function(){n.columnManagementValidate()}},n.columnManagementValidate=function(){n.safeUpdate(function(){n.management.instance.columnOption(n.management.currentColumn.dataField,"caption",n.columnManagementColumnName),n.management.instance.columnOption(n.management.currentColumn.dataField,"dataType",n.columnManagementColumnFormating.value.dataType),n.management.instance.columnOption(n.management.currentColumn.dataField,"format",{type:null,precision:null}),dxGridExtensions.isUndefinedOrNull(n.columnManagementColumnFormating.value.format)||(n.management.instance.columnOption(n.management.currentColumn.dataField,"format.type",n.columnManagementColumnFormating.value.format.type),n.management.instance.columnOption(n.management.currentColumn.dataField,"format.precision",n.columnManagementColumnFormating.value.format.precision));var e=_.find(n.management.groupItems,function(e){return e.column===n.management.currentColumn.dataField});dxGridExtensions.isUndefinedOrNull(e)||(dxGridExtensions.isUndefinedOrNull(n.columnManagementColumnFormating.value.format)?(e.valueFormat.type=null,e.valueFormat.precision=null):(e.valueFormat.type=n.columnManagementColumnFormating.value.format.type,e.valueFormat.precision=n.columnManagementColumnFormating.value.format.precision))}),n.management.showColumnManagementConsole=!1}}]),dxGridExtension.controller("gridManagementExtensions",["$scope",function(n){}]),dxGridExtension.controller("baseGridManagement",["$scope","attributes","element","parent","customColumnConfiguration","conditionalFormattingConfiguration","$controller","$timeout",function(n,e,t,o,i,a,l,s){function r(){var t=n.self[e.datasource];if(!dxGridExtensions.isUndefinedOrNull(t))if(Array.isArray(t))n.management.datasource=t;else{if(!Array.isArray(t._array))throw new Error("Unhandled datasource");n.management.datasource=t._array}}function m(){var e=n.management.datasource[0],t=0,o=_.transform(Object.keys(e),function(e,o){var i={dataField:o,caption:o,dataType:"string",visibleIndex:t++,hasAggregation:!1,format:{type:"",precision:0}},a=_.find(n.management.columns,function(n){return n.dataField==o});if(dxGridExtensions.isUndefinedOrNull(a)){for(var l=0;l<n.management.datasource.length;l++)if(!dxGridExtensions.isUndefinedOrNull(n.management.datasource[l][o])){if("boolean"==typeof n.management.datasource[l][o]){i.dataType="boolean",i.hasAggregation=!1;break}if(dxGridExtensions.isInt(n.management.datasource[l][o])){i.dataType="number",i.format={type:"fixedpoint",precision:0},i.hasAggregation=!0;break}if(dxGridExtensions.isFloat(n.management.datasource[l][o])){i.dataType="number",i.summaryType="sum",i.format={type:"fixedpoint",precision:2},i.hasAggregation=!0;break}i.dataType="string",i.format={type:"",precision:0};break}i.isCustomColumn=!1,e.push(i)}},[]);_.each(o,function(e){n.management.columns.push(e)})}function u(){_.each(n.management.customColumns,function(e){var t=_.find(n.management.columns,function(n){return n.dataField==e.name});t.isCustomColumn=!0,t.calculateCellValue=function(n){return i.computeCustomColumn(e.expression,n)},t.expression=e.expression})}function d(){if(n.canGroup){var e=n.management.columns,t=n.management.groupItems,o=_.transform(e,function(n,e){if("number"===e.dataType){var o=_.find(t,function(n){return e.dataField==n.column});if(dxGridExtensions.isUndefinedOrNull(o)&&e.hasAggregation){var i=f(e.dataField);n.push(i)}}},[]);_.each(o,function(e){n.management.groupItems.push(e)})}}function c(e,t){var o=n.management.instance.option(e);n.management.instance.option(e,function(n){null!=o&&o(n),t(n)})}function g(e){function t(n){for(var e in n)dxGridExtensions.isUndefinedOrNull(n[e])&&delete n[e]}_.each(n.management.columns,function(o){if(o.visible=e.component.columnOption(o.dataField,"visible"),o.visibleIndex=e.component.columnOption(o.dataField,"visibleIndex"),o.fixed=e.component.columnOption(o.dataField,"fixed"),o.fixedPosition=e.component.columnOption(o.dataField,"fixedPosition"),o.groupIndex=e.component.columnOption(o.dataField,"groupIndex"),o.sortOrder=e.component.columnOption(o.dataField,"sortOrder"),o.sortIndex=e.component.columnOption(o.dataField,"sortIndex"),o.hasAggregation=_.some(n.management.groupItems,function(n){return n.column==o.dataField}),o.isCustomColumn){var i=_.find(n.management.customColumns,function(n){return n.dataField==o.dataField});i.visible=o.visible,i.visibleIndex=o.visibleIndex,i.fixed=o.fixed,i.fixedPosition=o.fixedPosition,i.groupIndex=o.groupIndex,i.hasAggregation=o.hasAggregation,t(i)}t(o)})}function p(){if(dxGridExtensions.isUndefinedOrNull(n.$control))return null;try{var e=n.self[n.management.name].NAME?n.self[n.management.name]:n.getDevExpressControl();return n.management.instance!==e&&(n.management.instance=n.self[n.management.name]=e,s(function(){return n.management.instance.repaint()})),e}catch(n){return null}}function x(e){n.management.currentColumn=e.column,n.management.currentRow=e.row;var t=[{text:"Management - Columns",onItemClick:function(){n.management.showColumnChooserConsole=!0}},{text:"Management - Conditional Formatting",onItemClick:function(){n.management.showConditionalFormattingConsole=!0}},{text:"Management - Custom Columns",onItemClick:function(){n.management.showCustomColumnConsole=!0}},{text:"Current Column - Modify",onItemClick:function(){n.management.showColumnManagementConsole=!0}}];return n.canGroup&&(t.push({text:"Current Column - Remove Aggregation",onItemClick:function(){_.remove(n.management.groupItems,function(e){return e.column===n.management.currentColumn.dataField})}}),t.push({text:"Current Column - Create Aggregation",onItemClick:function(){if(null!=n.management.currentColumn&&"string"!=n.management.currentColumn.dataType){var e=n.management.groupItems;if(!dxGridExtensions.isUndefinedOrNull(e)){var t=_.find(n.self.gridManagement.groupItems,function(e){return e.column===n.management.currentColumn.dataField});if(dxGridExtensions.isUndefinedOrNull(t)){var o=f(n.management.currentColumn.dataField);n.management.groupItems.push(o)}}}}})),dxGridExtensions.isUndefinedOrNull(n.management.menu)||_.each(n.management.menu,function(n){t.push(n)}),t}function f(n){return{column:n,summaryType:"sum",showInGroupFooter:!1,alignByColumn:!0,valueFormat:{type:"fixedpoint",precision:2},displayFormat:"{0}"}}!function(){n.self=o,dxGridExtensions.isUndefinedOrNull(n.self.gridManagement)&&(n.self.gridManagement={}),n.management=n.self.gridManagement[e.instance]={},n.management.columns=[],n.management.groupItems=[],n.management.customColumns=[],n.management.conditionalFormattingRules=[],n.management.instance=n.self[e.instance],n.management.menu=n.self[e.menu],n.management.name=e.instance,n.management.options=n.self[e.options],n.management.datasource=n.self[e.datasource],n.$control=t,dxGridExtensions.isUndefinedOrNull(n.management.options.bindingOptions)&&(n.management.options.bindingOptions={}),n.management.options.bindingOptions.dataSource="management.datasource",n.management.options.bindingOptions.columns="management.columns",n.canGroup&&(n.management.options.bindingOptions["summary.groupItems"]="management.groupItems");var l=dxGridExtensions.isUndefinedOrNull(n.management.columns)?null:n.management.columns;if(n.management.columns=l,n.canGroup){var r=dxGridExtensions.isUndefinedOrNull(n.management.groupItems)?null:n.management.groupItems;n.canGroup||(n.management.groupItems=r)}n.management.export=function(){var t=n.self[e.datasource],o=new DevExpress.data.DataSource({store:t,paginate:!1});return o.filter(n.management.instance.getCombinedFilter()),o.load().then(function(e){for(var t=_.cloneDeep(e),o=_.transform(n.management.instance.getVisibleColumns(),function(n,e){n.push(e.dataField)},[]),a=0;a<t.length;a++)for(var l in t[a])t[a].hasOwnProperty(l)&&(_.some(o,function(n){return l===n})||delete t[a][l]);return _.each(t,function(e){_.each(n.management.customColumns,function(n){e[n.name]=i.computeCustomColumn(n.expression,e)})}),t})},n.management.save=function(){var e=n.canGroup?n.management.instance.state():null;return{columns:n.management.columns,conditionalFormattingRules:n.management.conditionalFormattingRules,customColumns:n.management.customColumns,groupItems:n.management.groupItems,name:n.management.name,state:e}},n.management.restore=function(e){n.isRestore=!0,s(function(){n.management.columns=[],n.management.groupItems=[],n.management.conditionalFormattingRules=_.transform(e.conditionalFormattingRules,function(n,e){n.push(a.createRule(e.text,e.target,e.expression,e.color,e.icon))},[]),n.management.customColumns=_.transform(e.customColumns,function(n,e){n.push(i.createCustomColumn(e.name,e.expression,e.formatting,e.visibleIndex))},[]),_.each(e.columns,function(e){n.management.columns.push(e)}),n.canGroup&&_.each(e.groupItems,function(e){n.management.groupItems.push(e)}),u(),n.canGroup&&n.management.instance.state(e.state),n.isRestore=!1})},s(function(){var e=p();dxGridExtensions.isUndefinedOrNull(e.option("onCellPrepared"))&&c("onCellPrepared",function(e){_.each(n.management.conditionalFormattingRules,function(t){a.applyConditionalFormattingExpressionOnCell(e,t,n.management.datasource,n.management.customColumns)})}),c("onContentReady",function(e){n.isRestore||g(e)}),c("onContextMenuPreparing",function(n){n.row&&"data"===n.row.rowType&&(n.items=x(n))}),c("customizeColumns",function(n){_.each(n,function(n){n.groupCellTemplate=window.dxGridExtensions.groupCellTemplate})})})}(),n.isRestore=!1,n.safeUpdate=function(e){n.management.instance.beginUpdate(),e(),n.management.instance.endUpdate()},n.$watch(function(){return n.self[e.datasource]},function(){r(),n.isRestore||dxGridExtensions.isUndefinedOrNull(n.self[e.datasource])||0==n.self[e.datasource].length||(m(),u(),d())}),l("gridManagementExtensions",{$scope:n}),l("columnManagement",{$scope:n}),l("conditionalFormatting",{$scope:n}),l("columnChooser",{$scope:n}),l("customColumns",{$scope:n})}]),dxGridExtension.directive("flatGrid",function(){return{restrict:"E",templateUrl:"view.grid.flat.html",scope:!0,controller:["$scope","$attrs","$element","$controller",function(n,e,t,o){n.getDevExpressControl=function(){return n.$control.find("#flatGrid").dxDataGrid("instance")},n.canGroup=!0,o("baseGridManagement",{$scope:n,attributes:e,element:t,parent:n.$parent})}]}}),dxGridExtension.directive("gridManagement",function(){return{restrict:"E",templateUrl:"view.grid.management.html"}}),dxGridExtension.directive("treeGrid",function(){return{restrict:"E",templateUrl:"view.grid.tree.html",scope:!0,controller:["$scope","$attrs","$element","$controller",function(n,e,t,o){n.getDevExpressControl=function(){return n.$control.find("#treeGrid").dxTreeList("instance")},n.canGroup=!1,o("baseGridManagement",{$scope:n,attributes:e,element:t,parent:n.$parent})}]}}),angular.module("dxGridExtensionTemplates").run(["$templateCache",function(n){n.put("view.grid.flat.html",'<div id="flatGrid" dx-data-grid="management.options"></div>\r\n<grid-management></grid-management>'),n.put("view.grid.management.html",'<div class="popup" id="conditionalFormattingConsole" dx-popup="conditionalFormattingPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div style="margin:5px;min-height:30px">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">Select an existing rule..</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:50%;" id="existingConditionalFormattingRules" dx-select-box="conditionalFormattingExistingRulesSelectBoxOptions"></div>\r\n                        <div style="float:right;width:20%;margin-left: 5px;" dx-button="conditionalFormattingDeleteExistingRuleButtonOptions"></div>\r\n                        <div style="float:right;width:20%;" dx-button="conditionalFormattingLoadExistingRuleButtonOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">...or create a new one</div>\r\n                <div class="dx-field">\r\n                    <div class="field-container">\r\n                        <div style="float:left;width:49%;margin-right:5px;" id="conditionalFormatingTargetColumn" dx-select-box="conditionalFormattingAvailableTargetColumnsOptions"></div>\r\n                        <div style="float:right;width:50%;" id="conditionalFormattingAvailableColumns" dx-select-box="conditionalFormattingAvailableColumnsSelectBoxOptions"></div>\r\n                    </div>\r\n                    <div style="float:left;width:100%;margin-top:5px;" dx-text-box="conditionalFormattingExpressionTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="margin:5px;float:left;width:65%;">\r\n                    <div style="top:50px;margin:5px;width:100%;" id="ruleTestingGrid" dx-data-grid="conditionalFormattingResultGridPopupOptions"></div>\r\n                </div>\r\n                <div style="margin:5px;float:right;width:30%;">\r\n                    <div id="conditionalFormattingRuleList" dx-list="rulesListOptions"></div>\r\n                    <div style="margin-top:10px;" dx-color-box="conditionalFormattingColorBox"></div>\r\n                    <div style="margin-top:10px;" dx-select-box="condtionalFormattingAvailableIconsSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="field-container">\r\n                <div style="float:left;width:48%;margin-bottom:20px;" dx-button="conditionalFormattingTestExpressionButtonOptions"></div>\r\n                <div style="float:right;width:48%;margin-bottom:20px;" dx-button="conditionalFormattingcreateButtonOptions"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="customColumnConsole" dx-popup="customColumnPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Select an existing custom column...</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:40%;" id="existingCustomColumns" dx-select-box="customColumnExistingCustomColumnsSelectBoxOptions"></div>\r\n                    <div style="float:right;width:28%;margin:0px;" dx-button="customColumndeleteExistingCustomColumnButtonOptions"></div>\r\n                    <div style="float:right;width:27%;margin:0px 5px 0px 0px;" dx-button="customColumnloadExistingCustomColumnButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">...or create a new one</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;">\r\n                    <div style="float:left;width:25%;margin-right:5px;" id="customColumnColumnName" dx-text-box="customColumnNameTextBoxOptions"></div>\r\n                    <div style="float:left;width:35%;" id="customColumnAvailableColumnsFormat" dx-select-box="customColumnAvailableFormattingSelectBoxOptions"></div>\r\n                    <div style="float:right;width:35%;" id="customColumnAvailableColumns" dx-select-box="customColumnAvailableColumnsSelectBoxOptions"></div>\r\n                </div>\r\n                <div style="width:100%;" dx-text-box="customColumnExpressionTextBoxOptions"></div>\r\n                <div style="width:100%;margin-top:5px;min-height:30px;">\r\n                    <div style="float:left;width:50%;margin:0px 5px 0px 0px;" dx-button="customColumnTestExpressionButtonOptions"></div>\r\n                    <div style="float:right;width:49%;margin:0px" dx-button="customColumncreateRuleButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="margin-top:10px;">\r\n            <div style="bottom:0;margin:5px;width:100%;" id="customColumnTestingGrid" dx-data-grid="customColumnResultGridOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnManagementPopup" dx-popup="columnManagementPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div class="dx-fieldset">\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Name</div>\r\n                <div class="dx-field-value">\r\n                    <div dx-text-box="columnManagementColumnNameTextBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-field">\r\n                <div class="dx-field-label">Format</div>\r\n                <div class="dx-field-value">\r\n                    <div id="columnManagementAvailableColumnsFormat" dx-select-box="columnManagementAvailableFormattingSelectBoxOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div style="width:100%;margin-top:5px;min-height:30px;">\r\n            <div id="columnManagementValidateButton" style="width:100%;margin:0px" dx-button="columnManagementValidateButtonOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="popup" id="columnChooserConsole" dx-popup="columnChooserPopupOptions">\r\n    <div data-options="dxTemplate: { name:\'info\' }">\r\n        <div id="columnChooserGrid" style="margin:10px" dx-data-grid="columnChooserGridOptions"></div>\r\n        <div style="width:100%;margin-top:10px;min-height:30px;" dx-button="columnChooserValidateButtonOptions"></div>\r\n    </div>\r\n</div>\r\n'),n.put("view.grid.tree.html",'<div id="treeGrid" dx-tree-list="management.options"></div>\r\n<grid-management></grid-management>')}]),dxGridExtension.factory("conditionalFormattingConfiguration",["$log","customColumnConfiguration",function($log,customColumnConfiguration){function applyConditionalFormattingExpressionOnCell(cell,rule,dataSource,customColumns){try{if("data"==cell.rowType&&!dxGridExtensions.isUndefinedOrNull(rule)&&!dxGridExtensions.isUndefinedOrNull(cell.value)&&rule.target==cell.column.dataField&&null!=cell.data){var self=this;if(rule.isExpressionBased){var expression=rule.expression,replacement={},processedExpression=expression,row=cell.row.data;_.forEach(row,function(n,e){dxGridExtensions.initFormulas(self);var t="string"==typeof n?"'"+n+"'":n,o=(_.sumBy(dataSource,function(n){return null!=n[rule.target]&&n[rule.target]>0?n[rule.target]:0}),_.find(customColumns,function(n){return n.dataField==e}));o&&(t=customColumnConfiguration.computeCustomColumn(o.expression,row),_.sumBy(dataSource,function(n){return customColumnConfiguration.computeCustomColumn(o.expression,n)})),processedExpression=processedExpression.split("["+e+"]").join(" "+t+" ")});var result=eval(processedExpression);result&&rule.formatting(cell,cell.value,sum,rule)}else{var value=cell.value,sum=_.sumBy(dataSource,function(n){return null!=n[rule.target]&&n[rule.target]>0?n[rule.target]:0}),customColum=_.find(customColumns,function(n){return n.dataField==cell.column.dataField});customColum&&(value=customColumnConfiguration.computeCustomColumn(customColum.expression,cell.row.data),sum=_.sumBy(dataSource,function(n){return customColumnConfiguration.computeCustomColumn(customColum.expression,n)})),rule.formatting(cell,value,sum,rule)}}}catch(n){$log.error(n)}}var rules=[{key:"Auto set",items:[{text:"Proportional Bars",isExpressionBased:!1,formatting:function(n,e,t,o){if("number"==n.column.dataType&&!(e<0)){var i="<div><div class='formatting bar superpose' style='background:"+o.color+";width:"+e/t*100+"%;''></div> <div class='formatting superpose'  style='z-index: 10;margin-top:-16px;'>"+n.text+"  </div></div>";n.cellElement.html(i)}}},{text:"Up/Down colors",isExpressionBased:!1,formatting:function(n,e,t,o){"number"==n.column.dataType&&(e>0?n.cellElement.css("color","green"):n.cellElement.css("color","red"))}},{text:"Up/Down icon",isExpressionBased:!1,formatting:function(n,e,t,o){"number"==n.column.dataType&&(e>0?n.cellElement.append('<span class="cb cb-chevron-up" style="color:green;"></span>'):n.cellElement.append('<span class="cb cb-chevron-down" style="color:red;"></span>'))}}]},{key:"Expression based",items:[{text:"Text color",isExpressionBased:!0,formatting:function(n,e,t,o){$(n.cellElement[0]).css("color",o.color)}},{text:"Background Color",isExpressionBased:!0,formatting:function(n,e,t,o){$(n.cellElement[0]).css("background-color",o.color)}},{text:"Icon",isExpressionBased:!0,formatting:function(n,e,t,o){n.cellElement.append('<span class="'+o.icon+'" style="color: '+o.color+';"></span>')}}]}],icons=[{name:"Arrow up",css:"cb cb-arrow-up"},{name:"Arrow down",css:"cb cb-arrow-down"},{name:"Chevron up",css:"cb cb-chevron-up"},{name:"Chevron down",css:"cb cb-chevron-down"},{name:"Spin up",css:"cb cb-spin-up"},{name:"Spin down",css:"cb cb-spin-down"},{name:"Favorites",css:"cb cb-favorites"},{name:"Like",css:"cb cb-like"},{name:"Info",css:"cb cb-info"},{name:"Todo",css:"cb cb-todo"}],getRuleTemplate=function(n){var e=getAllRules(),t=_.find(e,function(e){return e.text===n});return _.clone(t)},getRuleFromdescriptor=function(n){var e=getRuleTemplate(n.text);return _.extend(e,n)},getAllRules=function(){return _.transform(rules,function(n,e){_.each(e.items,function(e){n.push(e)},[])})},createRule=function(n,e,t,o,i){var a=getRuleTemplate(n);if(dxGridExtensions.isUndefinedOrNull(a))throw new Error("Rule "+n+" does not exist");return a.target=e,a.expression=t,a.color=o,a.icon=i,a};return{getRuleFromdescriptor:getRuleFromdescriptor,createRule:createRule,applyConditionalFormattingExpressionOnCell:applyConditionalFormattingExpressionOnCell,getAllRules:getAllRules,availableRules:rules,availableIcons:icons}}]),dxGridExtension.service("customColumnConfiguration",["$log",function($log){this.createCustomColumn=function(n,e,t,o){var i=this;return{name:n,expression:e,formatting:t,dataField:n,caption:n,isCustomColumn:!0,dataType:t.dataType,format:{type:t.format.type,precision:t.format.precision},visibleIndex:o,calculateCellValue:function(n){return i.computeCustomColumn(e,n)}}},this.computeCustomColumn=function(expression,data){try{var replacement={},processedExpression=expression;return dxGridExtensions.initFormulas(this),_.forEach(data,function(n,e){var t="string"==typeof n?"'"+n+"'":n;processedExpression=processedExpression.split("["+e+"]").join(" "+t+" ")}),eval(processedExpression)}catch(n){$log.error(n)}},this.customColumnFormats=[{text:"string",value:{dataType:"string",format:{type:"",precision:0}}},{text:"integer",value:{dataType:"number",format:{type:"fixedpoint",precision:0}}},{text:"percentage 2",value:{dataType:"number",format:{type:"percent",precision:2}}},{text:"percentage 5",value:{dataType:"number",format:{type:"percent",precision:5}}},{text:"decimal 2",value:{dataType:"number",format:{type:"fixedpoint",precision:2}}},{text:"decimal 5",value:{dataType:"number",format:{type:"fixedpoint",precision:5}}},{text:"boolean",value:{dataType:"boolean",format:{type:"",precision:0}}}]}]);